<link rel="import" href="/libraries/bower_components/polymer/polymer.html">
<link rel="import" href="/libraries/bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="/libraries/bower_components/bootstrap-styles/bootstrap-styles.html">

<dom-module id="dmw-login">
  <template>
    <style include="bootstrap-styles"></style>
    <style>
        body {
            color: #2D2C2F;
            background-color: white;
        width: 100%;
        height : 100%
        }

        .login {
            max-width: 350px;
        }
        .login .box {
            background-color: #FFFFFF;
            border-color: #005774 #D9D9D9 #D9D9D9;
            border-image: none;
            border-right: 1px solid #D9D9D9;
            border-style: solid;
            border-width: 5px 1px 1px;
            padding: 1em 1em 0 1em;
        }

        .login h1 {
            font-size: 2em;
            font-weight: normal;
            display: block;
            text-align: center;
        }

        .login .form-title {
            font-size: 1.2em;
            display: block;
            text-align: center;
            padding: 1em;
        }
    </style>

      <div class="box">
        <form id="login" action="/login" method="post" class="form-vertical login-form">
          <div class="form-title">{{ localize('login:welcome') }}</div>

          <div class="form-group">
            <label for="name" class="sr-only">{{ localize('login:name') }}</label>
            <div class="input-group">
              <span class="input-group-addon"><span class="glyphicon glyphicon-user" aria-hidden='true'></span></span>
              <input type="text" class="form-control" name="name" id="username" placeholder="{{ localize('login:name') }}">
            </div>
          </div>
          <div class="form-group">
            <label for="password" class="sr-only">{{ localize('login:password') }}</label>
            <div class="input-group">
              <span class="input-group-addon"><span class="glyphicon glyphicon-lock" aria-hidden='true'></span></span>
              <input type="password" class="form-control" name="password" id="password" placeholder="{{ localize('login:password') }}"></input>
            </div>
          </div>
          <div class="form-group">
            <div class="form-actions clearfix">
              <button class="submit btn btn-primary pull-right" type="submit" on-click="memorizeLogin">{{ localize('login:signIn') }} <span class="glyphicon glyphicon-chevron-right" aria-hidden='true'></span>
              </button>
              <a class="btn btn-default" id="helpBtn" on-click="showHelp"><span class="glyphicon glyphicon-question-sign" aria-hidden='true'></span> {{ localize('login:help') }}
              </a>
            </div>
          </div>
        </form>
      </div>

      <div class="modal" id="help" role="dialog" aria-labelledby="help" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="help">Domoweb login</h4>
            </div>
            <div class="modal-body">
              <p>{{ localize('login:helpMsg1') }}<a href="http://www.domogik.org/">Domogik</a>.</p>
              <p>{{ localize('login:helpMsg2') }}</p>
              <p>{{ localize('login:helpMsg3') }}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-info" data-dismiss="modal">{{ localize('login:close') }}</button>
            </div>
          </div>
        </div>
      </div>
  </template>
  <script>
        class DmwLogin extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], Polymer.GestureEventListeners(Polymer.Element)) {
            static get is () { return 'dmw-login'; }
            static get properties() {
                return {
                    /* Overriden from AppLocalizeBehavior */
                    language: {
                        value: navigator.language || navigator.userLanguage || navigator.browserLanguage || navigator.systemLanguage,
                        type: String
                    }
                }
            }
            constructor() {
                super();
                // For AppLocalizeBehavior : if the translation does not exist retourn the key
                this.useKeyIfMissing = true;
                this.loadResources(this.resolveUrl('/locales/domoweb/'+this.language+'/translation.json'),this.language);
            }
            connectedCallback() {
                super.connectedCallback();
            }
            showHelp() {
                $(this.$.help).modal("show");
            }
            memorizeLogin() {
                localStorage.setItem("username", this.$.username.value);
                localStorage.setItem("password", '*****');
            }
        }
    customElements.define(DmwLogin.is, DmwLogin);
    </script>
</dom-module>
