{% autoescape None %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
  <title>Domoweb</title>
  <link rel="stylesheet" href="/libraries/bootstrap-3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/libraries/notifIt-1.1/notifIt/css/notifIt.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/libraries/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="manifest" href="/manifests/manifest.json">
  <style type="text/css" id="gridstyle"></style>

  <style type="text/css" id="sectionstyle">
  body .widget.style-general {
    border: 1px solid {{ params['WidgetBorderColor'] }};
    background-color: {{ params['WidgetBackgroundColor'] }};
    border-radius: {{ params['WidgetBorderRadius'] }};
    color: {{ params['WidgetTextColor'] }};
    box-shadow: {{ params['WidgetBoxShadow'] }};
  }
  :root {
    --WidgetBorderColor: {{ params['WidgetBorderColor'] }};
    --WidgetBackgroundColor: {{ params['WidgetBackgroundColor'] }};
    --WidgetBorderRadius: {{ params['WidgetBorderRadius'] }};
    --WidgetTextColor: {{ params['WidgetTextColor'] }};
    --WidgetBoxShadow: {{ params['WidgetBoxShadow'] }};
  }

  body::after {
    content: "";
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
    z-index: 1;
  }
  </style>

  <script type="text/javascript">
    var DMW = DMW || {};
    DMW.main = DMW.main || {};
    DMW.main.edit = false;
    DMW.main.sectionReady = false;
    window.onload = function(){
        if ("ontouchstart" in document.documentElement) {
            document.documentElement.classList.add("touch");
        } else {
            document.documentElement.classList.add("no-touch");
        }
   //     window.addEventListener('resize', DMW.grid.hasResized);
   //     DMW.grid = document.getElementById('grid-layout');
        DMW.menu.init();
        DMW.navigation.init();
    };
  </script>
  <script src="/libraries/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="/libraries/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="/libraries/jquery-2.1.0/jquery.min.js"></script>
  <script type="text/javascript" src="/libraries/i18next-1.10.1/i18next-1.10.1.min.js"></script>

  <link rel="import" href="/components/grid-wrapper.html">

  <link rel="import" href="/components/polymer-ajax.html">
  <link rel="import" href="/components/websockets.html">
  <link rel="import" href="/components/widget.html">
  <link rel="import" href="/components/datatypes.html">
  <link rel="import" href="/components/section.html">
  <link rel="import" href="/components/widgetsSelector.html">
  <link rel="import" href="/components/butler.html">
</head>
<body id="body" unresolved>
  <div id="loading">
    <div class="box">
      <div class="loader" id="loader"></div>
      <div class="text" id="loading_text"></div>
    </div>
  </div>
  <dmw-datatypes id="datatypes"></dmw-datatypes>
  <web-socket id="socket"></web-socket>
  <polymer-ajax id="ajax" method="POST" url="/configuration"></polymer-ajax>
  <dmw-section id='currentsection' sectionid="{{ section.id }}"></dmw-section>

  <main role="main">
    <grid-wrapper id='grid-layout'></grid-wrapper>
  </main>

  <div id='main-menu-touch'>
      <div class="menu-item">
        <button id="acces-menu" onclick="activateCornerMenu();" class="acmbt"><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span></button>
    </div>
  </div>

  <div id='main-menu' class="">
      <div class="menu-cnitem">
          <div class="menu-button">
              <button class="cnbutton" id="cnbutton"><span class='sr-only' data-i18n="menu.open"></span></button>
              <nav id="cnwrapper" role="navigation">
              <ul id='main-menu-root'></ul>
              </nav>
              <div id="emptyoverlay" class="overlay"></div>
          </div>
      </div>
  </div>

  <div id="sections-tree" class="">
        <div class="menu-item">
            <button id="toggle-radial" class="menu-button"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></button>
        </div>
          {{ display_tree(sections, 0) }}
  </div>

  <div id="butler" class="">
      <div class="menu-item">
        <button id="toggle-radial-top-left" class="menu-button">
            <i class="fa fa-microphone"></i>
        </button>
      </div>
  </div>

  <div id="logout" class="">
      <div class="menu-item">
        <button id="toggle-radial-top-right" class="menu-button">
            <i class="fa fa-sign-out"></i>
        </button>
      </div>
  </div>
  <div id="modal-overlay" class="overlay"></div>

  <script type="text/javascript" src="/libraries/bootstrap-3.3.7/js/bootstrap.min.js"></script>
  <script src="/libraries/d3-3.5.6/d3.min.js"></script>
  <script src="/libraries/moment-2.10.6/min/moment.min.js"></script>
  <script type="text/javascript" src="/libraries/notifIt-1.1/notifIt/js/notifIt.min.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/menu.js"></script>
  <link rel="stylesheet" href="/css/menu.css">
  <script src="/js/navigation.js"></script>
  <link rel="stylesheet" href="/css/navigation.css">
  <script src="/libraries/colorful-background-css-generator/dist/colorful-background-css-generator.min.js"></script>
  <script src="/js/background.js"></script>

  <script type="text/javascript">
    i18n.init({
      load: 'current',
      //        lng: "en-US",
      fallbackLng: 'en-US',
      resGetPath: 'locales/__ns__/__lng__/translation.json',
      ns: {
    //    namespaces: ['domoweb', {% for pack in packs %}'{{pack[0]}}', {% end %}],
        namespaces: ['domoweb'],
        defaultNs: 'domoweb'
      }
    });

    function activateCornerMenu() {
        DMW.main.menu.classList.remove('menu-corners');
        DMW.main.navigation.classList.remove('menu-corners');
        document.getElementById('butler').classList.remove('menu-corners');
        document.getElementById('logout').classList.remove('menu-corners');;

        setTimeout(function() {
            DMW.main.menu.classList.add('menu-corners');
            DMW.main.navigation.classList.add('menu-corners');
            if (!DMW.main.navigation.getElementsByClassName('show')[0]) {
                DMW.main.navigation.getElementsByClassName('menu-button')[0].classList.remove('active');
            }
            document.getElementById('butler').classList.add('menu-corners');
            document.getElementById('logout').classList.add('menu-corners');;
            }, 10000)
    };

    $('#butler').click(function() {
        addButlerHandler();
    });

    window.addEventListener('WebComponentsReady', function(){
      DMW.main.socket.addEventListener('websocket-connected', websocketConnected);
      DMW.main.socket.addEventListener('websocket-closed', websocketClosed);
      DMW.main.socket.register('widgetinstance-added', instanceAdded);
      DMW.main.socket.register('widgetinstance-removed', instanceRemoved);
      DMW.main.socket.register('widgetinstance-moved', instanceMoved);
      DMW.main.section.addEventListener('section-updated', sectionUpdated);
      DMW.main.section.addEventListener('section-changed', sectionChanged);
      DMW.main.sectionReady = true;
    });
    $('#logout').click(function() {
        window.location = "/logout";
    });
  </script>
  </body>
</html>

