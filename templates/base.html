{% autoescape None %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
  <title>Domoweb</title>
  <link rel="stylesheet" href="/libraries/bootstrap-3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/libraries/notifIt-1.1/notifIt/css/notifIt.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/libraries/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="manifest" href="/manifests/manifest.json">
  <style type="text/css" id="gridstyle"></style>

  <style type="text/css" id="sectionstyle">
  body .widget.style-general {
    border: 1px solid {{ params['WidgetBorderColor'] }};
    background-color: {{ params['WidgetBackgroundColor'] }};
    border-radius: {{ params['WidgetBorderRadius'] }};
    color: {{ params['WidgetTextColor'] }};
    box-shadow: {{ params['WidgetBoxShadow'] }};
  }
  :root {
    --WidgetBorderColor: {{ params['WidgetBorderColor'] }};
    --WidgetBackgroundColor: {{ params['WidgetBackgroundColor'] }};
    --WidgetBorderRadius: {{ params['WidgetBorderRadius'] }};
    --WidgetTextColor: {{ params['WidgetTextColor'] }};
    --WidgetBoxShadow: {{ params['WidgetBoxShadow'] }};
  }

  body::after {
    content: "";
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
    z-index: 1;
  }
  </style>

  <script type="text/javascript">
    var DMW = DMW || {};
    DMW.main = DMW.main || {};
    DMW.main.edit = false;
    DMW.main.sectionReady = false;
    window.onload = function(){
        if ("ontouchstart" in document.documentElement) {
            document.documentElement.classList.add("touch");
        } else {
            document.documentElement.classList.add("no-touch");
        }
        DMW.menus.items = [
            {'id':'menuConfigure',
            'label':'menu:configuration'},
            {'id':'menuWidgets',
            'label':'menu:widgets',
            'childs': [
                {'id':'menuFinishWidgets',
                'label':'menu:finishWidgets',
                'close': true},
                {'id':'menuAddWidget',
                'label':'menu:addWidget'}
            ]},
            {'id':'menuSections',
            'label':'menu:sections',
            'childs': [
                {'id':'menuFinishSections',
                'label':'menu:finishSections',
                'close': true},
                {'id':'menuAddSection',
                'label':'menu:addSection'},
                {'id':'menuRemoveSection',
                'label':'menu:removeSection'}
            ]}
        ];

        DMW.menus.navigationInit();
    }
  </script>
  <script src="/libraries/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="/libraries/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="/libraries/jquery-2.1.0/jquery.min.js"></script>
  <script type="text/javascript" src="/libraries/i18next-1.10.1/i18next-1.10.1.min.js"></script>

  <link rel="import" href="/components/menu.html">
  <link rel="import" href="/components/grid-wrapper.html">

  <link rel="import" href="/components/polymer-ajax.html">
  <link rel="import" href="/components/websockets.html">
  <link rel="import" href="/components/widget.html">
  <link rel="import" href="/components/datatypes.html">
  <link rel="import" href="/components/section.html">
  <link rel="import" href="/components/widgetsSelector.html">
  <link rel="import" href="/components/butler.html">
</head>
<body id="body" unresolved>
  <div id="loading">
    <div class="box">
      <div class="loader" id="loader"></div>
      <div class="text" id="loading_text"></div>
    </div>
  </div>
  <dmw-datatypes id="datatypes"></dmw-datatypes>
  <web-socket id="socket"></web-socket>
  <polymer-ajax id="ajax" method="POST" url="/configuration"></polymer-ajax>
  <dmw-section id='currentsection' sectionid="{{ section.id }}"></dmw-section>

  <main role="main">
    <grid-wrapper id='grid-layout'></grid-wrapper>
  </main>

  <dmw-menu id="menus" itemstree="{{ display_tree(sections, 0) }}">
  </dmw-menu>
  <div id="modal-overlay" class="overlay"></div>

  <script type="text/javascript" src="/libraries/bootstrap-3.3.7/js/bootstrap.min.js"></script>
  <script src="/libraries/d3-3.5.6/d3.min.js"></script>
  <script src="/libraries/moment-2.10.6/min/moment.min.js"></script>
  <script type="text/javascript" src="/libraries/notifIt-1.1/notifIt/js/notifIt.min.js"></script>
  <script src="/js/main.js"></script>
  <script src="/libraries/colorful-background-css-generator/dist/colorful-background-css-generator.min.js"></script>
  <script src="/js/background.js"></script>

  <script type="text/javascript">
    window.addEventListener('WebComponentsReady', function(){
        if (!DMW.main.sectionReady) {
            DMW.main.socket.register('section-added', DMW.menus.navigationSectionsUpdated.bind(DMW.menus));
            DMW.main.socket.register('section-removed', DMW.menus.navigationSectionsUpdated.bind(DMW.menus));
            DMW.main.socket.register('section-tree', DMW.menus.navigationSectionsReceived.bind(DMW.menus));

            DMW.main.socket.addEventListener('websocket-connected', websocketConnected);
            DMW.main.socket.addEventListener('websocket-closed', websocketClosed);
            DMW.main.socket.register('widgetinstance-added', instanceAdded);
            DMW.main.socket.register('widgetinstance-removed', instanceRemoved);
            DMW.main.socket.register('widgetinstance-moved', instanceMoved);
            DMW.main.section.addEventListener('section-updated', sectionUpdated);
            DMW.main.section.addEventListener('section-changed', sectionChanged);
            DMW.main.sectionReady = true;
        }
    });
  </script>
  </body>
</html>

