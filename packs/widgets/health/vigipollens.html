<dom-module id="dmw-health-vigipollens">
    <template id="extended-styles">
        <!-- ln -s /var/lib/domogik/domogik_packages/plugin_vigipollens/domoweb/packs/widgets/pollens  /opt/dmg/domoweb/packs/widgets/pollens -->

        <style type="text/css">
            :host {
                --item-height : 17px;
                --date-posy : 21px;
                --contalergen-posy : 36px;
                --contlegend-posy : calc(var(--item-height) + var(--item-height) * 10);
            }
            #title {
                position: absolute;
                top : 0px;
                left : 0px
                color: white;
                width: 100%;
                font-size: calc(15px*var(--wscale-h)*var(--wscale-r));
                font-weight: bold;
                text-align: center;
            }

            #vdate{
                position: absolute;
                top: var(--date-posy);
                width: 100%;
                font-size: calc(11px*var(--wscale-h)*var(--wscale-r));
                text-align: center;
            }
            .contalergen {
                position: absolute;
                display: inline-flex;
                top: var(--contalergen-posy);
                width: 100%;
            }
            .contalergen .alergencol {
                width : 50%;
                padding-left: calc(10px*var(--wscale-w));
            }
            .contlegend .legendcol {
                width : 33%;
                padding-left: calc(10px*var(--wscale-w));
            }
            .contlegend {
                position: absolute;
                display: inline-flex;
                top: var(--contlegend-posy);
                width: 100%;
            }
            .contalergen li,
            .contlegend li {
                height: var(--item-height);
                line-height: var(--item-height);
            }
            .alergenlevel {
                display: inline-block;
                height: calc(12px*var(--wscale-h));
                width: calc(12px*var(--wscale-w));
                margin-top: calc(2px*var(--wscale-h));
                margin-right: 4px;
                border-style: solid;
                border-width: 1px;
            }
            .alergenname {
                display: inline-block;
                font-size: calc(10px*var(--wscale-h)*var(--wscale-r));
                margin-left: 3px;
            }
            .legend {
                display: inline-block;
                font-size: calc(10px*var(--wscale-h)*var(--wscale-r));
                margin-left: 5px;
                vertical-align: top;
            }
            #alergencolor1  {
                background: #E0E0D1;
            }
            #alergencolor2  {
                background: #E0E0D1;
            }
            #alergencolor3  {
                background: #E0E0D1;
            }
            #alergencolor4  {
                background: #E0E0D1;
            }
            #alergencolor5  {
                background: #E0E0D1;
            }
            #alergencolor6  {
                background: #E0E0D1;
            }
            #alergencolor7  {
                background: #E0E0D1;
            }
            #alergencolor8  {
                background: #E0E0D1;
            }
            #alergencolor9  {
                background: #E0E0D1;
            }
            #alergencolor10  {
                background: #E0E0D1;
            }
            #alergencolor11  {
                background: #E0E0D1;
            }
            #alergencolor12  {
                background: #E0E0D1;
            }
            #alergencolor13  {
                background: #E0E0D1;
            }
            #alergencolor14  {
                background: #E0E0D1;
            }
            #alergencolor15  {
                background: #E0E0D1;
            }
            #alergencolor16  {
                background: #E0E0D1;
            }
            #alergencolor17  {
                background: #E0E0D1;
            }
            #alergencolor18  {
                background: #E0E0D1;
            }
            #alergencolor19  {
                background: #E0E0D1;
            }

            .legendicon {
                display: inline-block;
                height: calc(12px*var(--wscale-h));
                width: calc(12px*var(--wscale-w));
                opacity: 1;
                margin-top: calc(2px*var(--wscale-h));
                border-style: solid;
                border-width: 1px;
                vertical-align: top;
            }
            #icon5  {
                background: red;
            }
            #icon4  {
                background: orange;
            }
            #icon3  {
                background: yellow;
            }
            #icon2  {
                background: blue;
            }
            #icon1  {
                background: #31B404;
            }
            #icon0  {
                background: white;
            }
        </style>
        <shadow>
        <dmw-sensor id='Departement' sensorkey='Departement' sensorvalue='{{Departement_value}}'></dmw-sensor>
        <dmw-sensor id='ValidityReport' sensorkey='ValidityReport' sensorvalue='{{ValidityReport_value}}'></dmw-sensor>
        <dmw-sensor id='MaxDepartementLevel' sensorkey='MaxDepartementLevel' sensorvalue='{{MaxDepartementLevel_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenCypress' sensorkey='AllergenCypress' sensorvalue='{{AllergenCypress_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenWillow' sensorkey='AllergenWillow' sensorvalue='{{AllergenWillow_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenAsh' sensorkey='AllergenAsh' sensorvalue='{{AllergenAsh_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenPoplar' sensorkey='AllergenPoplar' sensorvalue='{{AllergenPoplar_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenCharm' sensorkey='AllergenCharm' sensorvalue='{{AllergenCharm_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenBirch' sensorkey='AllergenBirch' sensorvalue='{{AllergenBirch_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenPlatane' sensorkey='AllergenPlatane' sensorvalue='{{AllergenPlatane_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenOak' sensorkey='AllergenOak' sensorvalue='{{AllergenOak_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenGramineae' sensorkey='AllergenGramineae' sensorvalue='{{AllergenGramineae_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenSorrel' sensorkey='AllergenSorrel' sensorvalue='{{AllergenSorrel_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenUrticaceae' sensorkey='AllergenUrticaceae' sensorvalue='{{AllergenUrticaceae_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenChestnut' sensorkey='AllergenChestnut' sensorvalue='{{AllergenChestnut_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenArmoise' sensorkey='AllergenArmoise' sensorvalue='{{AllergenArmoise_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenAlder' sensorkey='AllergenAlder' sensorvalue='{{AllergenAlder_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenHazelnut' sensorkey='AllergenHazelnut' sensorvalue='{{AllergenHazelnut_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenPlantain' sensorkey='AllergenPlantain' sensorvalue='{{AllergenPlantain_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenOlive' sensorkey='AllergenOlive' sensorvalue='{{AllergenOlive_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenAmbrosia' sensorkey='AllergenAmbrosia' sensorvalue='{{AllergenAmbrosia_value}}'></dmw-sensor>
        <dmw-sensor id='AllergenLinden' sensorkey='AllergenLinden' sensorvalue='{{AllergenLinden_value}}'></dmw-sensor>
        </shadow>

        <div id="title">{{ title }}</div><br>
        <div id="vdate">{{ vdate }}</div>
        <div class="contalergen">
            <div class="alergencol">
                <li><div class="alergenlevel" id="alergencolor1"></div><span class="alergenname">Cyprès</span></li>
                <li><div class="alergenlevel" id="alergencolor2"></div><span class="alergenname">Saule</span></li>
                <li><div class="alergenlevel" id="alergencolor3"></div><span class="alergenname">Frêne</span></li>
                <li><div class="alergenlevel" id="alergencolor4"></div><span class="alergenname">Peuplier</span></li>
                <li><div class="alergenlevel" id="alergencolor5"></div><span class="alergenname">Charme</span></li>
                <li><div class="alergenlevel" id="alergencolor6"></div><span class="alergenname">Bouleau</span></li>
                <li><div class="alergenlevel" id="alergencolor7"></div><span class="alergenname">Platane</span></li>
                <li><div class="alergenlevel" id="alergencolor8"></div><span class="alergenname">Chêne</span></li>
                <li><div class="alergenlevel" id="alergencolor9"></div><span class="alergenname">Graminées</span></li>
                <li><div class="alergenlevel" id="alergencolor10"></div><span class="alergenname">Oseille</span></li>
            </div>
            <div class="alergencol">
                <li><div class="alergenlevel" id="alergencolor11"></div><span class="alergenname">Urticacées</span></li>
                <li><div class="alergenlevel" id="alergencolor12"></div><span class="alergenname">Châtaignier</span></li>
                <li><div class="alergenlevel" id="alergencolor13"></div><span class="alergenname">Armoise</span></li>
                <li><div class="alergenlevel" id="alergencolor14"></div><span class="alergenname">Aulne</span></li>
                <li><div class="alergenlevel" id="alergencolor15"></div><span class="alergenname">Noisetier</span></li>
                <li><div class="alergenlevel" id="alergencolor16"></div><span class="alergenname">Plantain</span></li>
                <li><div class="alergenlevel" id="alergencolor17"></div><span class="alergenname">Olivier</span></li>
                <li><div class="alergenlevel" id="alergencolor18"></div><span class="alergenname">Ambroisies</span></li>
                <li><div class="alergenlevel" id="alergencolor19"></div><span class="alergenname">Tilleul</span></li>
            </div>
        </div>
        <div class="contlegend">
            <div class="legendcol">
                <li><div class="legendicon" id="icon0"></div><span class="legend">nul</span></li>
                <li><div class="legendicon" id="icon1"></div><span class="legend">faible</span></li>
            </div>
            <div class="legendcol">
                <li><div class="legendicon" id="icon2"></div><span class="legend">modéré</span></li>
                <li><div class="legendicon" id="icon3"></div><span class="legend">moyen</span></li>
            </div>
            <div class="legendcol">
                <li><div class="legendicon" id="icon4"></div><span class="legend">élévé</span></li>
                <li><div class="legendicon" id="icon5"></div><span class="legend">fort</span></li>
            </div>
        </div>

    </template>

    <script>
     (function () {
        let memoizedTemplate;

        class DmwHealthVigipollens extends DmwWidget {
            static get is () { return 'dmw-health-vigipollens'; }
            static get properties() {
                return {
                    Departement_value: {
                        notify: true,
                        observer: 'Departement_valueChanged',
                    },
                    MaxDepartementLevel_value: {
                        notify: true,
                        observer: 'MaxDepartementLevel_valueChanged'
                    },
                    ValidityReport_value: {
                        notify: true,
                        observer: 'ValidityReport_valueChanged',
                    },
                    AllergenCypress_value: {
                        notify: true,
                        observer: 'AllergenCypress_valueChanged',
                    },
                    AllergenWillow_value: {
                        notify: true,
                        observer: 'AllergenWillow_valueChanged',
                    },
                    AllergenAsh_value: {
                        notify: true,
                        observer: 'AllergenAsh_valueChanged',
                    },
                    AllergenPoplar_value: {
                        notify: true,
                        observer: 'AllergenPoplar_valueChanged',
                    },
                    AllergenCharm_value: {
                        notify: true,
                        observer: 'AllergenCharm_valueChanged',
                    },
                    AllergenBirsh_value: {
                        notify: true,
                        observer: 'AllergenBirsh_valueChanged',
                    },
                    AllergenPlatane_value: {
                        notify: true,
                        observer: 'AllergenPlatane_valueChanged',
                    },
                    AllergenOak_value: {
                        notify: true,
                        observer: 'AllergenOak_valueChanged',
                    },
                    AllergenGramineae_value: {
                        notify: true,
                        observer: 'AllergenGramineae_valueChanged',
                    },
                    AllergenSorrel_value: {
                        notify: true,
                        observer: 'AllergenSorrel_valueChanged',
                    },
                    AllergenUrticaceae_value: {
                        notify: true,
                        observer: 'AllergenUrticaceae_valueChanged',
                    },
                    AllergenChestnut_value: {
                        notify: true,
                        observer: 'AllergenChestnut_valueChanged',
                    },
                    AllergenArmoise_value: {
                        notify: true,
                        observer: 'AllergenArmoise_valueChanged',
                    },
                    AllergenAlder_value: {
                        notify: true,
                        observer: 'AllergenAlder_valueChanged',
                    },
                    AllergenHazelnut_value: {
                        notify: true,
                        observer: 'AllergenHazelnut_valueChanged',
                    },
                    AllergenPlantain_value: {
                        notify: true,
                        observer: 'AllergenPlantain_valueChanged',
                    },
                    AllergenOlive_value: {
                        notify: true,
                        observer: 'AllergenOlive_valueChanged',
                    },
                    AllergenAmbrosia_value: {
                        notify: true,
                        observer: 'AllergenAmbrosia_valueChanged',
                    },
                    AllergenLinden_value: {
                        notify: true,
                        observer: 'AllergenLinden_valueChanged',
                    }
                }
            }
            static get template() {
              if (!memoizedTemplate) {
                // start with clone of superclass template
                memoizedTemplate = DmwWidget.template.cloneNode(true);
                // get some stuff you want to insert into super template
                const subStyle = Polymer.DomModule.import(this.is, 'template#extended-styles').content;
                // insert stuff in template after the super template's <style>
                const superStyle = memoizedTemplate.content.querySelector('style');
                superStyle.parentNode.insertBefore(subStyle, superStyle.nextSibling);
              }
              return memoizedTemplate;
            }
            constructor() {
                super();
                this.ratioConstraint = 'width';
                this.title = "Risques allergiques";
                this.vdate = "----";
            }
            connectedCallback() {
                super.connectedCallback();
            }
            resized(){
                const
                    titleH = this.$.title.clientHeight,
                    dateH = this.$.vdate.clientHeight,
                    itemSize = Math.round((this.clientHeight - (titleH+dateH)) / 13);
                this.style.setProperty("--item-height", `${itemSize}px`);
                this.style.setProperty("--date-posy", `${titleH}px`);
                this.style.setProperty("--contalergen-posy", `${titleH+dateH}px`);
                let posy = itemSize*11+(titleH+dateH);
                if ((posy + 2*itemSize) >= this.clientHeight) {
                    posy -= ((posy + 2*itemSize) - this.clientHeight) + 2
                }
                this.style.setProperty("--contlegend-posy", `${posy}px`);

            }
            Departement_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.title = "Risques allergiques (" + newValue + ")";
            }

            ValidityReport_valueChanged(newValue, oldValue) {
                newValue = new Date(newValue.stored_value);
                this.vdate = "Mise à jour le " + newValue.toLocaleDateString();
            }

            MaxDepartementLevel_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.title.style.color = getVigipollenColor(newValue) ;
            }

            AllergenCypress_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor1.style.background = getVigipollenColor(newValue) ;
            }
            AllergenWillow_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor2.style.background = getVigipollenColor(newValue) ;
            }
            AllergenAsh_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor3.style.background = getVigipollenColor(newValue) ;
            }
            AllergenPoplar_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor4.style.background = getVigipollenColor(newValue) ;
            }
            AllergenCharm_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor5.style.background = getVigipollenColor(newValue) ;
            }
            AllergenBirsh_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor6.style.background = getVigipollenColor(newValue) ;
            }
            AllergenPlatane_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor7.style.background = getVigipollenColor(newValue) ;
            }
            AllergenOak_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor8.style.background = getVigipollenColor(newValue) ;
            }
            AllergenGramineae_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor9.style.background = getVigipollenColor(newValue) ;
            }
            AllergenSorrel_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor10.style.background = getVigipollenColor(newValue) ;
            }
            AllergenUrticaceae_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor11.style.background = getVigipollenColor(newValue) ;
            }
            AllergenChestnut_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor12.style.background = getVigipollenColor(newValue) ;
            }
            AllergenArmoise_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor13.style.background = getVigipollenColor(newValue) ;
            }
            AllergenAlder_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor14.style.background = getVigipollenColor(newValue) ;
            }
            AllergenHazelnut_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor15.style.background = getVigipollenColor(newValue) ;
            }
            AllergenPlantain_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor16.style.background = getVigipollenColor(newValue) ;
            }
            AllergenOlive_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor17.style.background = getVigipollenColor(newValue) ;
            }
            AllergenAmbrosia_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor18.style.background = getVigipollenColor(newValue) ;
            }
            AllergenLinden_valueChanged(newValue, oldValue) {
                newValue = newValue.stored_value ;
                this.$.alergencolor19.style.background = getVigipollenColor(newValue) ;
            }

	    };

    function getVigipollenColor(level) {
            switch(level) {         // "0", to, "5"
                case '0':
                    return "white" ;
                case '1':
                    return "#31B404" ;
                case '2':
                    return "blue" ;
                case '3':
                    return "yellow" ;
                case '4':
                    return "orange" ;
                case '5':
                    return "red" ;
                default:
                    return "white" ;
            }
        }
    customElements.define(DmwHealthVigipollens.is, DmwHealthVigipollens);
    })();
    </script>
</dom-module>
