<dom-module id="dmw-basic-commandcolorrgb">
    <template id="extended-styles">
        <link rel="stylesheet" href="/widget/basic/css/common.css" shim-domshadow>
        <style type="text/css">
            :host {
                height: 100%;
            }
            #current {
                border: 1px solid black;
                width: calc(35px*var(--wscale-h)*var(--wscale-r));
                height: calc(35px*var(--wscale-h)*var(--wscale-r));
                border-radius: 50%;
                position: relative;
                top: calc(95px*var(--wscale-h)*var(--wscale-r));
                left: calc(95px*var(--wscale-h)*var(--wscale-r));
                -webkit-transform: translate(-50%, -50%);
                -ms-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
                z-index: 7;
            }

            #flower {
                width: 100%;
                height: 100%;
            }

            .petal{
                background                      : lightblue;
                width                           : calc(60px*var(--wscale-h)*var(--wscale-r));
                height                          : calc(60px*var(--wscale-h)*var(--wscale-r));
                position                        : absolute;
                display                         : block;
                overflow                        : hidden;

                border-left: 0px solid transparent;

                border-radius                   : calc(50px*var(--wscale-h)*var(--wscale-r));
                -webkit-border-radius           : calc(50px*var(--wscale-h)*var(--wscale-r));
                -moz-border-radius              : calc(50px*var(--wscale-h)*var(--wscale-r));

                border-top-right-radius         : 0;
                -webkit-border-top-right-radius : 0;
                -moz-border-radius-topright     : 0;

                border-bottom-left-radius       : calc(30px*var(--wscale-h)*var(--wscale-r));
                -webkit-border-bottom-left-radius : calc(30px*var(--wscale-h)*var(--wscale-r));
                -moz-border-radius-bottomleft   : calc(30px*var(--wscale-h)*var(--wscale-r));


                transform                       : rotate(-45deg);
                -webkit-transform               : rotate(-45deg);
                -moz-transform                  : rotate(-45deg);
                -o-transform                    : rotate(-45deg);
                -ms-transform                   : rotate(-45deg);


                transition                      : all 1s;
                -webkit-transition              : all 1s;
                -moz-transition                 : all 1s;
                -o-transition                   : all 1s;
                -ms-transition                  : all 1s;
            }

            /**************
            .petal.sm {
                width                           : 60px;
                height                          : 60px;
                position                        : absolute;

                border-radius                   : 75px;
                -webkit-border-radius           : 75px;
                -moz-border-radius              : 75px;

                border-top-right-radius         : 0;
                -webkit-border-top-right-radius : 0;
                -moz-border-radius-topright     : 0;
            }

            .petal.lg {
                width                           : 100px;
                height                          : 100px;
                position                        : absolute;

                border-radius                   : 125px;
                -webkit-border-radius           : 125px;
                -moz-border-radius              : 125px;

                border-top-right-radius         : 0;
                -webkit-border-top-right-radius : 0;
                -moz-border-radius-topright     : 0;
            }
            **************/


            .petal:nth-child(1) {
                transform                       : rotate(-64deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-64deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-64deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-64deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-64deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(112px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(77.5px*var(--wscale-h)*var(--wscale-r));
                z-index: 3;


            }
            .petal:nth-child(2) {
                transform                       : rotate(-124deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-124deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-124deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-124deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-124deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(77.5px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(112px*var(--wscale-h)*var(--wscale-r));
                z-index: 2;
            }
            .petal:nth-child(3) {
                transform                       : rotate(-184deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-184deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-184deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-184deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-184deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(30.5px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(99.5px*var(--wscale-h)*var(--wscale-r));
                z-index: 3;
            }
            .petal:nth-child(4) {
                transform                       : rotate(-244deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-244deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-244deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-244deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-244deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(17.5px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(52px*var(--wscale-h)*var(--wscale-r));
                z-index: 4;
            }
            .petal:nth-child(5) {
                transform                       : rotate(-304deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-304deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-304deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-304deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-304deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(52px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(17.5px*var(--wscale-h)*var(--wscale-r));
                z-index: 5;
            }
            .petal:nth-child(6) {
                transform                       : rotate(-4deg) skewX(-12deg) skewY(-4deg);
                -webkit-transform               : rotate(-4deg) skewX(-12deg) skewY(-4deg);
                -moz-transform                  : rotate(-4deg) skewX(-12deg) skewY(-4deg);
                -o-transform                    : rotate(-4deg) skewX(-12deg) skewY(-4deg);
                -ms-transform                   : rotate(-4deg) skewX(-12deg) skewY(-4deg);
                top                             : calc(99.5px*var(--wscale-h)*var(--wscale-r));
                left                            : calc(30.5px*var(--wscale-h)*var(--wscale-r));
                z-index: 6;
            }

        </style>
        <slot>
            <dmw-command id="setcolor" commandkey="setcolor"></dmw-command>
            <dmw-sensor id='color' sensorkey="color" sensorvalue="{{colorvalue}}" sensornotified="current"></dmw-sensor>
        </slot>
        <div id="flower">
          <div id="black" class="petal"></div>
          <div id="white" class="petal"></div>
          <div id="color1" class="petal"></div>
          <div id="color2" class="petal"></div>
          <div id="color3" class="petal"></div>
          <div id="color4" class="petal"></div>
          <div id="current"></div>
        </div>
    </template>
    <script>
    (function() {
      let memoizedTemplate;

      class DmwBasicCommandColorRGB extends DmwWidget {
            static get is () { return 'dmw-basic-commandcolorrgb'; }
            static get properties() {
                return {
                    colorvalue: {
                        notify: true,
                        observer: 'colorvalueChanged'
                    }
                }
            }
            static get template() {
              if (!memoizedTemplate) {
                // start with clone of superclass template
                memoizedTemplate = DmwWidget.template.cloneNode(true);
                // get some stuff you want to insert into super template
                const subStyle = Polymer.DomModule.import(this.is, 'template#extended-styles').content;
                // insert stuff in template after the super template's <style>
                const superStyle = memoizedTemplate.content.querySelector('style');
                superStyle.parentNode.insertBefore(subStyle, superStyle.nextSibling);
              }
              return memoizedTemplate;
            }
            constructor() {
                super();
                this.ratioConstraint = 'width';
            }
            connectedCallback() {
                super.connectedCallback();
                this._events = false;
            }
            optionsUpdated() {
                if (this.options['hideLabels'] == true ) {
                    this.$.labelprimary.style.visibility = "hidden";
                    this.$.labelsecondary.style.visibility = "hidden";
                }
                else {
                    this.$.labelprimary.style.visibility = "visible";
                    this.$.labelsecondary.style.visibility = "visible";
                }
            }
            sensorsUpdated() {
                if (this.$.color.isSet) {
                    // nothing to do
                    this.$.black.style.backgroundColor = "black";
                    this.$.white.style.backgroundColor = "white";
                    this.$.color1.style.backgroundColor = "#" + this.options['color1'];
                    this.$.color2.style.backgroundColor = "#" + this.options['color2'];
                    this.$.color3.style.backgroundColor = "#" + this.options['color3'];
                    this.$.color4.style.backgroundColor = "#" + this.options['color4'];
                }
            }
            commandsUpdated() {
                if (this.$.setcolor.isSet) {
                    this.labelprimary = this.$.setcolor.device['name'];
                    this.labelsecondary = this.$.setcolor.name;
                    if ((this.currentValue == 0) && (this.options['label0'] != undefined) && (this.options['label0'] != "")) {
                        this.sendtext = this.options['label0'];
                    }
                    else if ((this.currentValue == 1) && (this.options['label1'] != undefined) && (this.options['label1'] != "")) {
                        this.sendtext = this.options['label1'];
                    }
                    else {
                        this.sendtext = i18n.t("domoweb:bool." + this.currentValue, { context: this.$.setcolor.parameters[0]['datatype_id'] });
                    }
                    if (!this._events) {
                        this.$.black.addEventListener('click', this.sendBlack.bind(this));
                        this.$.white.addEventListener('click', this.sendWhite.bind(this));
                        this.$.color1.addEventListener('click', this.sendColor1.bind(this));
                        this.$.color2.addEventListener('click', this.sendColor2.bind(this));
                        this.$.color3.addEventListener('click', this.sendColor3.bind(this));
                        this.$.color4.addEventListener('click', this.sendColor4.bind(this));
                        this._events = true;
                    }
                }
            }
            sendBlack(e) {
                this.sendAColor(e, "000000");
            }
            sendWhite(e) {
                this.sendAColor(e, "ffffff");
            }
            sendColor1(e) {
                this.sendAColor(e, this.colorNameToHex(this.options['color1']));
            }
            sendColor2(e) {
                this.sendAColor(e, this.colorNameToHex(this.options['color2']));
            }
            sendColor3(e) {
                this.sendAColor(e, this.colorNameToHex(this.options['color3']));
            }
            sendColor4(e) {
                this.sendAColor(e, this.colorNameToHex(this.options['color4']));
            }
            sendAColor(e, color) {
                var parameters = {};
                parameters[this.$.setcolor.parameters[0]['key']] = color;
                this.$.setcolor.send(parameters);
                e.preventDefault();
                e.stopPropagation();
            }
            colorvalueChanged(newValue, oldValue) {
                if (this.$.color.isSet) {
                    this.$.current.style.backgroundColor = "#"+newValue.stored_value;
                }
            }
            colorNameToHex(colour) {
                var colours = {"aliceblue":"f0f8ff",
                               "antiquewhite":"faebd7",
                               "aqua":"00ffff",
                               "aquamarine":"7fffd4",
                               "azure":"f0ffff",
                               "beige":"f5f5dc",
                               "bisque":"ffe4c4",
                               "black":"000000",
                               "blanchedalmond":"ffebcd",
                               "blue":"0000ff",
                               "blueviolet":"8a2be2",
                               "brown":"a52a2a",
                               "burlywood":"deb887",
                               "cadetblue":"5f9ea0",
                               "chartreuse":"7fff00",
                               "chocolate":"d2691e",
                               "coral":"ff7f50",
                               "cornflowerblue":"6495ed",
                               "cornsilk":"fff8dc",
                               "crimson":"dc143c",
                               "cyan":"00ffff",
                               "darkblue":"00008b",
                               "darkcyan":"008b8b",
                               "darkgoldenrod":"b8860b",
                               "darkgray":"a9a9a9",
                               "darkgreen":"006400",
                               "darkkhaki":"bdb76b",
                               "darkmagenta":"8b008b",
                               "darkolivegreen":"556b2f",
                               "darkorange":"ff8c00",
                               "darkorchid":"9932cc",
                               "darkred":"8b0000",
                               "darksalmon":"e9967a",
                               "darkseagreen":"8fbc8f",
                               "darkslateblue":"483d8b",
                               "darkslategray":"2f4f4f",
                               "darkturquoise":"00ced1",
                               "darkviolet":"9400d3",
                               "deeppink":"ff1493",
                               "deepskyblue":"00bfff",
                               "dimgray":"696969",
                               "dodgerblue":"1e90ff",
                               "firebrick":"b22222",
                               "floralwhite":"fffaf0",
                               "forestgreen":"228b22",
                               "fuchsia":"ff00ff",
                               "gainsboro":"dcdcdc",
                               "ghostwhite":"f8f8ff",
                               "gold":"ffd700",
                               "goldenrod":"daa520",
                               "gray":"808080",
                               "green":"008000",
                               "greenyellow":"adff2f",
                               "honeydew":"f0fff0",
                               "hotpink":"ff69b4",
                               "indianred ":"cd5c5c",
                               "indigo":"4b0082",
                               "ivory":"fffff0",
                               "khaki":"f0e68c",
                               "lavender":"e6e6fa",
                               "lavenderblush":"fff0f5",
                               "lawngreen":"7cfc00",
                               "lemonchiffon":"fffacd",
                               "lightblue":"add8e6",
                               "lightcoral":"f08080",
                               "lightcyan":"e0ffff",
                               "lightgoldenrodyellow":"fafad2",
                               "lightgrey":"d3d3d3",
                               "lightgreen":"90ee90",
                               "lightpink":"ffb6c1",
                               "lightsalmon":"ffa07a",
                               "lightseagreen":"20b2aa",
                               "lightskyblue":"87cefa",
                               "lightslategray":"778899",
                               "lightsteelblue":"b0c4de",
                               "lightyellow":"ffffe0",
                               "lime":"00ff00",
                               "limegreen":"32cd32",
                               "linen":"faf0e6",
                               "magenta":"ff00ff",
                               "maroon":"800000",
                               "mediumaquamarine":"66cdaa",
                               "mediumblue":"0000cd",
                               "mediumorchid":"ba55d3",
                               "mediumpurple":"9370d8",
                               "mediumseagreen":"3cb371",
                               "mediumslateblue":"7b68ee",
                               "mediumspringgreen":"00fa9a",
                               "mediumturquoise":"48d1cc",
                               "mediumvioletred":"c71585",
                               "midnightblue":"191970",
                               "mintcream":"f5fffa",
                               "mistyrose":"ffe4e1",
                               "moccasin":"ffe4b5",
                               "navajowhite":"ffdead",
                               "navy":"000080",
                               "oldlace":"fdf5e6",
                               "olive":"808000",
                               "olivedrab":"6b8e23",
                               "orange":"ffa500",
                               "orangered":"ff4500",
                               "orchid":"da70d6",
                               "palegoldenrod":"eee8aa",
                               "palegreen":"98fb98",
                               "paleturquoise":"afeeee",
                               "palevioletred":"d87093",
                               "papayawhip":"ffefd5",
                               "peachpuff":"ffdab9",
                               "peru":"cd853f",
                               "pink":"ffc0cb",
                               "plum":"dda0dd",
                               "powderblue":"b0e0e6",
                               "purple":"800080",
                               "red":"ff0000",
                               "rosybrown":"bc8f8f",
                               "royalblue":"4169e1",
                               "saddlebrown":"8b4513",
                               "salmon":"fa8072",
                               "sandybrown":"f4a460",
                               "seagreen":"2e8b57",
                               "seashell":"fff5ee",
                               "sienna":"a0522d",
                               "silver":"c0c0c0",
                               "skyblue":"87ceeb",
                               "slateblue":"6a5acd",
                               "slategray":"708090",
                               "snow":"fffafa",
                               "springgreen":"00ff7f",
                               "steelblue":"4682b4",
                               "tan":"d2b48c",
                               "teal":"008080",
                               "thistle":"d8bfd8",
                               "tomato":"ff6347",
                               "turquoise":"40e0d0",
                               "violet":"ee82ee",
                               "wheat":"f5deb3",
                               "white":"ffffff",
                               "whitesmoke":"f5f5f5",
                               "yellow":"ffff00",
                               "yellowgreen":"9acd32"};

                if (typeof colours[colour.toLowerCase()] != 'undefined')
                    return colours[colour.toLowerCase()];

                // if no corresponding value, return the raw color
                return colour;
            }
        };
        customElements.define(DmwBasicCommandColorRGB.is, DmwBasicCommandColorRGB);
    })();
    </script>
</dom-module>
